# HSAML format #

Alignments generated with PRANK contain more information than can be stored using the traditional sequence alignment formats, so we have defined a new alignment format called HSAML. Currently the slightly outdated program [PRANKSTER](http://www.ebi.ac.uk/goldman-srv/prank/prankster/) provides the only graphical front-end to open and browse HSAML alignments but we are working on a new software for this purpose.

The HSAML format follows the XML standards and, in addition to PRANKSTER, any program supporting the XML is able to open and manipulate the alignments. Two of the possible software packages to handle the data are R (see [here](http://www.r-project.org/)), a free software environment for statistical computing and graphics, and perl (see [here](http://www.perl.org/)), a cross-platform programming language. We will not go into details of R and perl here but provide simple examples how to manipulate HSAML-formatted data using these two packages. Which ever is your choice of a programming language, it is strongly recommended that you use one of the existing XML parsers to import the HSAML alignments and will not try to read them as text files!

# Definition #

The [XML schema](http://wiki.prank-msa.googlecode.com/git/hsaml/ms_alignment.xsd) gives a formal definition of the HSAML format.

An alignment generated by PRANK/PRANKSTER consist of four
elements: <font color='red'>newick</font>, <font color='blue'>nodes</font>, <font color='green'>selection</font>
and <font color='orange'>model</font>; sub-elements
of <font color='blue'>nodes</font> are either <font color='cyan'>leaf</font> or <font color='purple'>node</font>.
Colours refer to [this example alignment](http://code.google.com/p/prank-msa/wiki/HSAMLExample?tm=6).

The element <font color='CC0000'>newick</font>
defines the alignment guide tree (or phylogeny) in the 'newick' format.
The tree should be complete and have a name for each node (terminal and
internal) and a branch length for each branch. A node name and branch
length are separated by a colon, two sister nodes separated by a comma
and surrounded by a pair of brackets. A node name can be any
alpha-numeric string (A-Za-z0-9 + some other characters) except that
the names for internal nodes are always surrounded by hash signs (#)
and the names for terminal nodes never contain hashes. It is convenient
to keep the node names short and provide more information in <font color='blue'>nodes</font>.

The element <font color='blue'>nodes</font>
contains terminal and internal nodes. A terminal node is defined in <font color='cyan'>leaf</font> and has attributes 'id',
which matches a node name in the newick tree, and 'name',the full name
of the sequence. The only content of a leaf is 'sequence', an aligned
sequence. An internal node is defined in <font color='purple'>node</font>
and has one attribute, 'id' that matches a node name in the newick
tree. The contents of a node are of the type 'probability', each having
the attribute 'id' matching one of the process id's in the element <font color='orange'>model</font>.

The element <font color='006600'>selection</font>
is optional and only appears when a user has deselected some of the
alignment sites using filters based on the sitewise posterior
probabilities. Selection consists of 'selected\_sites', a boolean vector
defining if a site is selected/deselected, and 'selection\_criteria', a
description of the process resulting to the current selection.

The element <font color='orange'>model</font>
has two purposes: first, it gives further information of the processes
for which nodes contain posterior probabilities for (attributes 'id'
and 'name'), and, second, it specifies how PRANKSTER displays this
information. The meaning of different attributes becomes obvious if one
plays with PRANKSTER (Settings->Plot), and the range of possible
attribute values is defined in the [XML schema](http://wiki.prank-msa.googlecode.com/git/hsaml/ms_alignment.xsd).

# Examples #

## R ##

This R script plots the posterior probability of one of the processes across the alignment sites. If you download the [script here](http://wiki.prank-msa.googlecode.com/git/hsaml/plot_xml.rs) and the [example alignment here](http://wiki.prank-msa.googlecode.com/git/hsaml/CAV2.xml), start R and type the command
```
source("plot_xml.rs")
```
you should obtain a plot similar to this:

<img src='http://wiki.prank-msa.googlecode.com/git/hsaml/cav2.png' width='600'>

(To reproduce the plot shown here, you should download <a href='http://wiki.prank-msa.googlecode.com/git/hsaml/plot_xml_full.rs'>this script</a>.)<br>
<br>
The plotted value is the posterior probability of the slow process across the alignment sites in the three internal nodes. In the two latter plots, the broad peaks match rather well with the known coding exons that are indicated by the black bars in the top (not included in the example script).<br>
<br>
Note that the script requires XML package to be installed. R packages can be found from the <a href='http://www.r-project.org/'>project homepage</a> following the links to CRAN and Packages. Consult the R manual to learn more about the package installation.<br>
<br>
<h2>Perl</h2>

This perl script demonstrates how to select nodes and clades of an alignment tree, manipulate sequences, extract posterior probability values and work with names and id's. A detailed explanation of the use of the script and the functions implemented in the module is given in the source code file.<br>
<br>
The script and the additional module required by the script can be downloaded from <a href='http://wiki.prank-msa.googlecode.com/git/hsaml/parseExample.pl'>here</a> and <a href='http://wiki.prank-msa.googlecode.com/git/hsaml/Node.pm'>here</a>, and the use of the script tested with this <a href='http://wiki.prank-msa.googlecode.com/git/hsaml/20prim.xml'>example dataset</a>. Typing<br>
<pre><code>perl parseExample.pl <br>
</code></pre>
should read in the alignment and print out the location and sequence of the sites for which the alignment reliability score is below 50% in the human-chimp subtree.<br>
<br>
Note that the script requires the <code>XML::libXML</code> module to be installed (download it from <a href='http://search.cpan.org/dist/XML-LibXML'>here</a>). Consult the perl manual to learn more about the package installation.<br>
<br>
<br>
<h2>Acknowledgements</h2>

The XML schema was defined by Nicolas Rodriguez. Contact rodrigue@ebi.ac.uk for details.